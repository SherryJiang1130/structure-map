{"id":"libs/rightMenu/index.ts","dependencies":[{"name":"C:\\Users\\jiangxueyan\\Desktop\\mind\\package.json","includedInParent":true,"mtime":1539846455631}],"generated":{"js":"\"use strict\";\n\nexports.__esModule = true;\nvar that = null;\n\nvar Rightmenu =\n/** @class */\nfunction () {\n  function Rightmenu(containerId, rePaitFn, data) {\n    this.id = 'menu';\n    this.wrap = document.getElementById(containerId);\n    this.createdMenu();\n    this.rightClickFn(containerId, this.id);\n    this.rePaitFn = rePaitFn;\n    this.data = data;\n    that = this;\n  }\n\n  Rightmenu.prototype.createdMenu = function () {\n    var menuTitle = [{\n      name: '添加子节点',\n      val: 'add'\n    }, {\n      name: '修改节点',\n      val: 'edit'\n    }, {\n      name: '移除节点',\n      val: 'remove'\n    }];\n    var ul = document.createElement('ul');\n    ul.setAttribute('id', this.id);\n    ul.classList.add('hidden');\n\n    for (var i = 0, len = menuTitle.length; i < len; i++) {\n      var li = document.createElement('li');\n      var a = document.createElement('a');\n      var node = document.createTextNode(menuTitle[i].name);\n      a.appendChild(node);\n      a.setAttribute('href', 'javascript:void(0)');\n      a.setAttribute('id', menuTitle[i].val);\n      a.addEventListener('click', this.clickHandle);\n      li.appendChild(a);\n      ul.appendChild(li);\n    }\n\n    this.wrap.appendChild(ul);\n  };\n\n  Rightmenu.prototype.clickHandle = function (e) {\n    if (e.target.id == 'add') {\n      that.addChildNode();\n    }\n\n    if (e.target.id == 'remove') {\n      that.removeNode();\n    }\n\n    if (e.target.id == 'edit') {\n      that.editText();\n    }\n  };\n\n  Rightmenu.prototype.removeNode = function () {\n    for (var index = that.data.length - 1; index >= 0; index--) {\n      var element = that.data[index];\n\n      if (element.id == that.selectDomId) {\n        that.data.splice(index, 1);\n      } else {\n        if (element[\"in\"] && element[\"in\"].length < 2 && element[\"in\"][0] == that.selectDomId) {\n          that.data.splice(index, 1);\n        } else if (element[\"in\"]) {\n          var i = element[\"in\"].indexOf(that.selectDomId);\n\n          if (i > -1) {\n            element[\"in\"].splice(i, 1);\n          }\n        }\n      }\n    }\n\n    that.rePaitFn(that.data);\n  };\n\n  Rightmenu.prototype.addChildNode = function () {\n    Math.random();\n    that.data.push({\n      \"in\": [that.selectDomId],\n      id: (Math.random() * Date.now() / 100000000000).toFixed(2) + 'Newjob',\n      type: 'command'\n    });\n    that.rePaitFn(that.data);\n  };\n\n  Rightmenu.prototype.editText = function () {\n    var text = window.prompt('请输入新值', that.selectDomId);\n\n    if (!text || text == that.selectDomId) {\n      return;\n    }\n\n    that.data.forEach(function (element) {\n      if (element.id == that.selectDomId) {\n        element.id = text;\n      }\n    });\n    that.rePaitFn(that.data);\n  };\n\n  Rightmenu.prototype.preventDefault = function (event) {\n    event.preventDefault() ? event.preventDefault() : event.returnValue = false;\n  };\n\n  Rightmenu.prototype.getScrollTop = function () {\n    if (document.compatMode == 'CSS1Compat') {\n      return document.documentElement.scrollTop;\n    } else {\n      return document.body.scrollTop;\n    }\n  };\n\n  Rightmenu.prototype.getScrollLeft = function () {\n    if (document.compatMode == 'CSS1Compat') {\n      return document.documentElement.scrollLeft;\n    } else {\n      return document.body.scrollLeft;\n    }\n  };\n\n  Rightmenu.prototype.rightClickFn = function (containerId, id) {\n    var domId = document.getElementById(containerId);\n\n    domId.oncontextmenu = function (event) {\n      if (event.target.nodeName != 'rect' && event.target.nodeName != 'tspan') {\n        return;\n      }\n\n      that.preventDefault(event);\n      var menu = document.getElementById(id);\n      var top = that.getScrollTop();\n      var left = that.getScrollLeft();\n      var leftStyle = event.pageX ? event.pageX : event.clientX + left;\n      var topStyle = event.pageY ? event.pageY : event.clientY + top;\n      menu.style.left = leftStyle + 'px';\n      menu.style.top = topStyle + 'px';\n      menu.style.visibility = 'visible';\n      menu.style.height = 'auto';\n\n      if (event.target.nodeName == 'rect') {\n        that.selectDomId = event.target.nextSibling.childNodes[0].childNodes[0].nodeValue;\n      } else {\n        that.selectDomId = event.target.innerHTML;\n      }\n    };\n\n    document.onclick = function () {\n      document.getElementById(id).style.visibility = 'hidden';\n    };\n  };\n\n  return Rightmenu;\n}();\n\nexports[\"default\"] = Rightmenu;"},"hash":"e4989cc74aed6333dc4e32164d4e3dd5","cacheData":{"env":{}}}